{"version":3,"sources":["file:///E:/CocosCreator/StormSunder_Github/StormSunder/assets/module_storm_sunder/Script/RankUI.ts"],"names":["Component","Label","_decorator","AttributeBonusMgr","EventDispatcher","GameEvent","GameUtil","PlayerMgr","ccclass","property","RankUI","rank1","rank2","rank3","rank4","onLoad","node","getChildByName","delay","initUI","rigisterEvent","active","lbName","getComponent","console","log","inst","userModel","nickName","string","lbHeight","game_tornado_base_height","start","onRefreshRank","rankList","getRanking","i","Math","min","length","rankNode","playerData","height","currentPlayerIndex","findIndex","player","instance","on","EVENT_REFRESH_RANK"],"mappings":"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","sourcesContent":["import { Button, Component, Label, Node, NodeEventType, _decorator, find } from 'cc';\r\nimport { AttributeBonusMgr } from './Manager/AttributeBonusMgr';\r\nimport { EventDispatcher } from '../../core_tgx/easy_ui_framework/EventDispatcher';\r\nimport { GameEvent } from './Enum/GameEvent';\r\nimport { GameUtil } from './GameUtil';\r\nimport { PlayerMgr } from './Manager/PlayerMgr';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n *排行面板\r\n */\r\n@ccclass('RankUI')\r\nexport class RankUI extends Component {\r\n\r\n    rank1: Node = null;\r\n    rank2: Node = null;\r\n    rank3: Node = null;\r\n    rank4: Node = null;\r\n\r\n    protected async onLoad() {\r\n        this.rank1 = this.node.getChildByName(\"Rank1\");\r\n        this.rank2 = this.node.getChildByName(\"Rank2\");\r\n        this.rank3 = this.node.getChildByName(\"Rank3\");\r\n        this.rank4 = this.node.getChildByName(\"Rank4\");\r\n\r\n        await GameUtil.delay(0.2);\r\n        this.initUI();\r\n        this.rigisterEvent();\r\n    }\r\n\r\n    private initUI() {\r\n        this.rank1.active = true;\r\n        this.rank2.active = false;\r\n        this.rank3.active = false;\r\n        this.rank4.active = false;\r\n\r\n        const lbName = this.rank1.getChildByName(\"LbName\").getComponent(Label);\r\n        console.log('AttributeBonusMgr.inst.userModel.nickName:', AttributeBonusMgr.inst.userModel.nickName);\r\n        lbName.string = `${AttributeBonusMgr.inst.userModel.nickName}`;\r\n        const lbHeight = this.rank1.getChildByName(\"LbHeight\").getComponent(Label);\r\n        lbHeight.string = `${AttributeBonusMgr.inst.userModel.game_tornado_base_height} m`;\r\n    }\r\n\r\n    protected start(): void {\r\n    }\r\n\r\n    private onRefreshRank() {\r\n        const rankList = PlayerMgr.inst.getRanking();\r\n        // console.log('rankList:', rankList);\r\n\r\n        // Hide all rank nodes first\r\n        this.rank1.active = false;\r\n        this.rank2.active = false;\r\n        this.rank3.active = false;\r\n        this.rank4.active = false;\r\n\r\n        // Display top 3 rankings\r\n        for (let i = 0; i < Math.min(3, rankList.length); i++) {\r\n            const rankNode = this[`rank${i + 1}`];\r\n            const playerData = rankList[i];\r\n\r\n            rankNode.active = true;\r\n            rankNode.getChildByName(\"LbName\").getComponent(Label).string = playerData.nickName;\r\n            rankNode.getChildByName(\"LbHeight\").getComponent(Label).string = `${playerData.height} m`;\r\n        }\r\n\r\n        // Check if current player is not in top 3 and there are more than 3 players\r\n        if (rankList.length > 3) {\r\n            const currentPlayerIndex = rankList.findIndex(player =>\r\n                player.nickName === AttributeBonusMgr.inst.userModel.nickName\r\n            );\r\n\r\n            if (currentPlayerIndex >= 3) {\r\n                this.rank4.active = true;\r\n                const playerData = rankList[currentPlayerIndex];\r\n                this.rank4.getChildByName(\"LbName\").getComponent(Label).string = playerData.nickName;\r\n                this.rank4.getChildByName(\"LbHeight\").getComponent(Label).string = `${playerData.height} m`;\r\n            }\r\n        }\r\n    }\r\n\r\n    private rigisterEvent() {\r\n        EventDispatcher.instance.on(GameEvent.EVENT_REFRESH_RANK, this.onRefreshRank, this);\r\n    }\r\n\r\n}\r\n"]}