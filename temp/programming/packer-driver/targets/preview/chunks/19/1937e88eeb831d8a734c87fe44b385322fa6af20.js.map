{"version":3,"sources":["file:///E:/CocosCreator/StormSunder_Github/StormSunder/assets/module_storm_sunder/Script/Component/ButtonComponent.ts"],"names":["Button","Component","Label","NodeEventType","_decorator","StormSunderAudioMgr","AttributeBonusMgr","BonusType","ccclass","property","ButtonComponent","start","addUIEvent","updateBtView","ATTACK","SPEED","EXP","onUpdateBtnsStatus","btnAttack","node","on","TOUCH_END","onClickHandler","btSpeed","btExp","type","playOneShot","getMusicIdName","userModel","inst","bonus","bonusData","checkMoneyEnough","upgradeCost","console","log","updateBtStatus","consumeMoney","level","getUpgradeCost","updateBonus","getBonus","max","buttonNode","getButtonNodeByType","lbLevel","getChildByName","getComponent","useddMoney","usedAd","lbMoney","string","active","usedMoney","canAfford"],"mappings":"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","sourcesContent":["import { Button, Component, Label, Node, NodeEventType, _decorator, find } from 'cc';\r\nimport { GameEvent } from '../Enum/GameEvent';\r\nimport { EventDispatcher } from 'db://assets/core_tgx/easy_ui_framework/EventDispatcher';\r\nimport { GlobalConfig } from 'db://assets/start/Config/GlobalConfig';\r\nimport { AdvertMgr } from 'db://assets/core_tgx/base/ad/AdvertMgr';\r\nimport { StormSunderAudioMgr } from '../Manager/StormSunderAudioMgr';\r\nimport { AttributeBonusMgr, BonusType } from '../Manager/AttributeBonusMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * 底部按钮控制器\r\n */\r\n@ccclass('ButtonComponent')\r\nexport class ButtonComponent extends Component {\r\n    @property(Button) btnAttack: Button = null!;\r\n    @property(Button) btSpeed: Button = null!;\r\n    @property(Button) btExp: Button = null!;\r\n\r\n    protected start(): void {\r\n        this.addUIEvent();\r\n        this.updateBtView(BonusType.ATTACK);\r\n        this.updateBtView(BonusType.SPEED);\r\n        this.updateBtView(BonusType.EXP);\r\n        this.onUpdateBtnsStatus();\r\n    }\r\n\r\n    private addUIEvent(): void {\r\n        this.btnAttack.node.on(NodeEventType.TOUCH_END, () => this.onClickHandler(BonusType.ATTACK), this);\r\n        this.btSpeed.node.on(NodeEventType.TOUCH_END, () => this.onClickHandler(BonusType.SPEED), this);\r\n        this.btExp.node.on(NodeEventType.TOUCH_END, () => this.onClickHandler(BonusType.EXP), this);\r\n    }\r\n\r\n    private onClickHandler(type: BonusType): void {\r\n        StormSunderAudioMgr.playOneShot(StormSunderAudioMgr.getMusicIdName(2), 1.0);\r\n        const { userModel } = AttributeBonusMgr.inst;\r\n        const bonus = userModel.bonusData[type];\r\n\r\n        // 检查金额是否足够\r\n        if (!AttributeBonusMgr.inst.checkMoneyEnough(bonus.upgradeCost)) {\r\n            console.log(\"金额不足\");\r\n            //DOTO 看广告\r\n            this.updateBtStatus(type);\r\n            return;\r\n        }\r\n\r\n        // 扣除金额\r\n        if (!AttributeBonusMgr.inst.consumeMoney(bonus.upgradeCost)) {\r\n            return;\r\n        }\r\n\r\n        // 升级逻辑\r\n        bonus.level++;\r\n        // 更新升级消耗\r\n        bonus.upgradeCost += AttributeBonusMgr.inst.getUpgradeCost(type);\r\n        AttributeBonusMgr.inst.updateBonus(type);\r\n\r\n        // 更新按钮状态\r\n        this.updateBtView(type);\r\n        this.onUpdateBtnsStatus();\r\n\r\n        console.log(`当前属性最终加成:${AttributeBonusMgr.inst.getBonus(type)}`)\r\n    }\r\n\r\n    private onUpdateBtnsStatus(): void {\r\n        this.updateBtStatus(BonusType.ATTACK);\r\n        this.updateBtStatus(BonusType.SPEED);\r\n        this.updateBtStatus(BonusType.EXP);\r\n    }\r\n\r\n    private updateBtView(type: BonusType, max?: boolean): void {\r\n        const { userModel } = AttributeBonusMgr.inst;\r\n        const { bonusData } = userModel;\r\n        const buttonNode = this.getButtonNodeByType(type);\r\n\r\n        const lbLevel: Label = buttonNode.getChildByName('LbLv').getComponent(Label)!;\r\n        const useddMoney = buttonNode.getChildByName('UsedMoney')!;\r\n        const usedAd = buttonNode.getChildByName('UsedAd')!;\r\n        const lbMoney: Label = useddMoney.getChildByName('LbAmount').getComponent(Label)!;\r\n\r\n        if (max) {\r\n            lbLevel.string = 'MAX';\r\n            useddMoney.active = false;\r\n            usedAd.active = false;\r\n        } else {\r\n            const bonus = bonusData[type];\r\n            lbLevel.string = `LV.${bonus.level}`;\r\n            lbMoney.string = `${bonus.upgradeCost}`;\r\n        }\r\n    }\r\n\r\n    private updateBtStatus(type: BonusType): void {\r\n        const { userModel } = AttributeBonusMgr.inst;\r\n        const bonus = userModel.bonusData[type];\r\n        const buttonNode = this.getButtonNodeByType(type);\r\n        const usedMoney = buttonNode.getChildByName('UsedMoney')!;\r\n        const usedAd = buttonNode.getChildByName('UsedAd')!;\r\n\r\n        // 检查金额是否足够\r\n        const canAfford = AttributeBonusMgr.inst.checkMoneyEnough(bonus.upgradeCost);\r\n\r\n        // 金额不够显示广告图标，够则显示金额\r\n        usedMoney.active = canAfford;\r\n        usedAd.active = !canAfford;\r\n    }\r\n\r\n    private getButtonNodeByType(type: BonusType): Node {\r\n        return {\r\n            [BonusType.ATTACK]: this.btnAttack.node,\r\n            [BonusType.SPEED]: this.btSpeed.node,\r\n            [BonusType.EXP]: this.btExp.node,\r\n        }[type];\r\n    }\r\n\r\n}\r\n"]}