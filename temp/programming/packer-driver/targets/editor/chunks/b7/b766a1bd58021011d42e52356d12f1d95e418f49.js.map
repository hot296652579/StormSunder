{"version":3,"sources":["file:///E:/CocosCreator/StormSunder_Github/StormSunder/assets/core_tgx/easy_adapter/AdapterSafeArea.ts"],"names":["Widget","_decorator","EDITOR","Adapter","ccclass","property","executeInEditMode","menu","Flags","AdapterSafeArea","tooltip","visible","isAlignTop","isAlignBottom","isAlignLeft","isAlignRight","_isDirty","setFlag","flag","value","current","_flags","TOP","v","BOTTOM","LEFT","RIGHT","top","_top","bottom","_bottom","left","_left","right","_right","widget","comp","getComponent","addComponent","resetInEditor","doLayout","isForce","isFullScreenAdaption","enabled","isAbsoluteTop","direction","Portrait","safeArea","outside","height","isAbsoluteBottom","UpsideDown","isAbsoluteLeft","LandscapeLeft","width","isAbsoluteRight","LandscapeRight","updateAlignment","doOnAdapterComplete","onChangeSize","update","dt","None"],"mappings":"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","sourcesContent":["import { Widget, _decorator } from \"cc\";\r\nimport { EDITOR } from \"cc/env\";\r\nimport { Adapter } from \"./Adapter\";\r\n\r\nconst { ccclass, property, executeInEditMode, menu } = _decorator;\r\n\r\nenum Flags {\r\n    None = 0,\r\n    TOP = 1 << 0,\r\n    BOTTOM = 1 << 1,\r\n    LEFT = 1 << 2,\r\n    RIGHT = 1 << 3,\r\n}\r\n\r\n/**\r\n * @classdesc  安全区域适配Widget , App.isFullScreenAdaption = true 时有效\r\n * @description\r\n *\r\n * 用法：\r\n *\r\n * 1. 将本组件挂载在节点上即可（注意：该节点上必须挂在 Widget 组件）\r\n *\r\n * 适配原理：\r\n *\r\n * 1. 根据安全区域范围，修改widget组件属性\r\n * 自动添加刘海宽度，以避免显示到安全区域之外\r\n */\r\n@ccclass(\"AdapterSafeArea\")\r\n@executeInEditMode\r\n@menu(\"Quick适配组件/AdapterSafeArea\")\r\nexport default class AdapterSafeArea extends Adapter {\r\n\r\n    @property\r\n    protected _flags: number = Flags.None;\r\n\r\n    protected setFlag(flag: Flags, value: boolean) {\r\n        const current = (this._flags & flag) > 0;\r\n        if (value == current) {\r\n            return;\r\n        }\r\n        if (value) {\r\n            this._flags |= flag;\r\n        } else {\r\n            this._flags &= ~flag;\r\n        }\r\n        this._isDirty = true;\r\n    }\r\n\r\n    @property({ tooltip: EDITOR ? \"是否对齐上边\" : \"\" })\r\n    get isAlignTop() {\r\n        return (this._flags & Flags.TOP) > 0;\r\n    }\r\n    set isAlignTop(v) {\r\n        this.setFlag(Flags.TOP, v);\r\n    }\r\n\r\n    @property({ tooltip: EDITOR ? \"是否对齐下边\" : \"\" })\r\n    get isAlignBottom() {\r\n        return (this._flags & Flags.BOTTOM) > 0;\r\n    }\r\n    set isAlignBottom(v) {\r\n        this.setFlag(Flags.BOTTOM, v);\r\n    }\r\n\r\n    @property({ tooltip: EDITOR ? \"是否对齐左边\" : \"\" })\r\n    get isAlignLeft() {\r\n        return (this._flags & Flags.LEFT) > 0;\r\n    }\r\n    set isAlignLeft(v) {\r\n        this.setFlag(Flags.LEFT, v);\r\n    }\r\n\r\n    @property({ tooltip: EDITOR ? \"是否对齐右边\" : \"\" })\r\n    get isAlignRight() {\r\n        return (this._flags & Flags.RIGHT) > 0;\r\n    }\r\n    set isAlignRight(v) {\r\n        this.setFlag(Flags.RIGHT, v);\r\n    }\r\n\r\n    @property\r\n    _top = 0;\r\n    @property({\r\n        visible: function (this: AdapterSafeArea) {\r\n            return this.isAlignTop;\r\n        }, tooltip: EDITOR ? \"本节点顶边和父节点顶边的距离，可填写负值，只有在 isAlignTop 开启时才有作用\" : \"\"\r\n    })\r\n    get top() {\r\n        return this._top;\r\n    }\r\n    set top(v) {\r\n        if (this._top == v) {\r\n            return;\r\n        }\r\n        this._top = v;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    @property\r\n    _bottom = 0;\r\n    @property({\r\n        visible: function (this: AdapterSafeArea) {\r\n            return this.isAlignBottom;\r\n        }, tooltip: EDITOR ? \"本节点顶边和父节点底边的距离，可填写负值，只有在 isAlignBottom 开启时才有作用\" : \"\"\r\n    })\r\n    get bottom() {\r\n        return this._bottom;\r\n    }\r\n    set bottom(v) {\r\n        if (this._bottom == v) {\r\n            return;\r\n        }\r\n        this._bottom = v;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    @property\r\n    _left = 0;\r\n    @property({\r\n        visible: function (this: AdapterSafeArea) {\r\n            return this.isAlignLeft;\r\n        }, tooltip: EDITOR ? \"本节点顶边和父节点左边的距离，可填写负值，只有在 isAlignLeft 开启时才有作用\" : \"\"\r\n    })\r\n    get left() {\r\n        return this._left;\r\n    }\r\n    set left(v) {\r\n        if (this._left == v) {\r\n            return;\r\n        }\r\n        this._left = v;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    @property\r\n    _right = 0;\r\n    @property({\r\n        visible: function (this: AdapterSafeArea) {\r\n            return this.isAlignRight;\r\n        }, tooltip: EDITOR ? \"本节点顶边和父节点右边的距离，可填写负值，只有在 isAlignRight 开启时才有作用\" : \"\"\r\n    })\r\n    get right() {\r\n        return this._right;\r\n    }\r\n    set right(v) {\r\n        if (this._right == v) {\r\n            return;\r\n        }\r\n        this._right = v;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    protected _isDirty = false;\r\n\r\n    protected get widget() {\r\n        let comp = this.getComponent(Widget);\r\n        if (comp) {\r\n            return comp;\r\n        }\r\n        return this.addComponent(Widget);\r\n    }\r\n\r\n    resetInEditor() {\r\n        this.doLayout(true);\r\n    }\r\n\r\n    protected doLayout(isForce = false) {\r\n        if (this._isDirty || isForce) {\r\n            let widget = this.widget!;\r\n            if (EDITOR) {\r\n                widget.left = this.left;\r\n                widget.right = this.right;\r\n                widget.top = this.top;\r\n                widget.bottom = this.bottom;\r\n                return;\r\n            }\r\n            if (!this.isFullScreenAdaption) {\r\n                return;\r\n            }\r\n            if (!widget || !widget.enabled) {\r\n                return;\r\n            }\r\n            // 屏幕向上时，加上安全区域高度\r\n            if (widget.isAlignTop && this.isAlignTop) {\r\n                widget.isAbsoluteTop = true;\r\n                if (this.direction == Adapter.direction.Portrait) {\r\n                    widget.top = this.top + Adapter.safeArea.outside.height;\r\n                } else {\r\n                    widget.top = this.top;\r\n                }\r\n            }\r\n            // 屏幕向下时，加上安全区域高度\r\n            if (widget.isAlignBottom && this.isAlignBottom) {\r\n                widget.isAbsoluteBottom = true;\r\n                if (this.direction == Adapter.direction.UpsideDown) {\r\n                    widget.bottom = this.bottom + Adapter.safeArea.outside.height;\r\n                } else {\r\n                    widget.bottom = this.bottom;\r\n                }\r\n            }\r\n            // 屏幕向左时，加上安全区域宽度\r\n            if (widget.isAlignLeft && this.isAlignLeft) {\r\n                widget.isAbsoluteLeft = true;\r\n                if (this.direction == Adapter.direction.LandscapeLeft) {\r\n                    widget.left = this.left + Adapter.safeArea.outside.width;\r\n                } else {\r\n                    widget.left = this.left;\r\n                }\r\n\r\n            }\r\n            // 屏幕向右时，加上安全区域宽度\r\n            if (widget.isAlignRight && this.isAlignRight) {\r\n                widget.isAbsoluteRight = true;\r\n                if (this.direction == Adapter.direction.LandscapeRight) {\r\n                    widget.right = this.right + Adapter.safeArea.outside.width;\r\n                } else {\r\n                    widget.right = this.right;\r\n                }\r\n            }\r\n            widget.updateAlignment();\r\n            this._isDirty = false;\r\n            this.doOnAdapterComplete();\r\n        }\r\n    }\r\n\r\n    protected onChangeSize() {\r\n        this.doLayout(true);\r\n    }\r\n\r\n    protected update(dt: number) {\r\n        super.update && super.update(dt);\r\n        this.doLayout();\r\n    }\r\n}\r\n"]}